<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Generate Voucher ‚Äì HCP</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f9ff;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 15px;
    }
    label {
      font-weight: bold;
    }
    h2 {
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üìù Generate Voucher</h2>

    <label>Select Format</label>
    <select id="formatSelect" onchange="loadFormat()">
      <option value="">-- Select Format --</option>
    </select>

    <label>Recipient</label>
    <input type="text" id="recipient" placeholder="Enter Name" />

    <label>Amount</label>
    <input type="text" id="amount" placeholder="Enter Amount" />

    <label>Description</label>
    <textarea id="descField" readonly></textarea>

    <button onclick="generatePDF()">üìÑ Generate PDF</button>
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    let formats = JSON.parse(localStorage.getItem("voucherFormats")) || [];

    function populateFormats() {
      const select = document.getElementById("formatSelect");
      formats.forEach((f, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = f.title;
        select.appendChild(opt);
      });
    }

    function loadFormat() {
      const index = document.getElementById("formatSelect").value;
      if (index !== "") {
        document.getElementById("descField").value = formats[index].desc;
      } else {
        document.getElementById("descField").value = "";
      }
    }

    function generatePDF() {
      const recipient = document.getElementById("recipient").value.trim();
      const amount = document.getElementById("amount").value.trim();
      const desc = document.getElementById("descField").value.trim();
      const formatIndex = document.getElementById("formatSelect").value;

      if (!recipient || !amount || !desc || formatIndex === "") {
        alert("Please fill all fields and select a format.");
        return;
      }

      const format = formats[formatIndex];
      const doc = new jsPDF();

      doc.setFontSize(18);
      doc.text("HEPATITIS & INFECTION CONTROL PROGRAM", 20, 20);
      doc.setFontSize(14);
      doc.text(`Voucher: ${format.title}`, 20, 40);
      doc.text(`Recipient: ${recipient}`, 20, 50);
      doc.text(`Amount: ${amount}`, 20, 60);
      doc.text("Description:", 20, 70);
      doc.setFontSize(12);
      doc.text(desc, 20, 80);

      // watermark logo if exists
      if (format.fileData.includes("image")) {
        doc.addImage(format.fileData, "JPEG", 140, 10, 50, 50);
      }

      doc.save(`Voucher_${recipient}.pdf`);
    }

    populateFormats();
  </script>

</body>
</html>
