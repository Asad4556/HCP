<!-- generate_voucher.html -->
<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <title>ğŸ§¾ ÙˆÙˆÚ†Ø± Ø¨Ù†Ø§Ø¦ÛŒÚº</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section>
    <h2>ğŸ§¾ ÙˆÙˆÚ†Ø± ÙØ§Ø±Ù…ÛŒÙ¹ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</h2>

    <label>ÙˆÙˆÚ†Ø± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:</label>
    <select id="formatSelect">
      <option value="">-- Ú©ÙˆØ¦ÛŒ Ø§ÛŒÚ© ÙˆÙˆÚ†Ø± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº --</option>
    </select>

    <div id="filePreview" style="margin-top: 15px;"></div>

    <form id="voucherForm" style="display: none;">
      <label>ÙˆØµÙˆÙ„ Ú©Ù†Ù†Ø¯Û Ú©Ø§ Ù†Ø§Ù…:</label>
      <input type="text" id="recipient" required>

      <label>ØªØ§Ø±ÛŒØ®:</label>
      <input type="date" id="date" required>

      <label>ØªÙØµÛŒÙ„ / Ø±ÛŒÙ…Ø§Ø±Ú©Ø³:</label>
      <textarea id="remarks" rows="4" required></textarea>

      <button type="submit">âœ… ÙˆÙˆÚ†Ø± Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
    </form>
  </section>

  <script>
    const formats = JSON.parse(localStorage.getItem("voucherFormats") || "{}");
    const formatNames = JSON.parse(localStorage.getItem("voucherFormatNames") || "[]");

    const formatSelect = document.getElementById("formatSelect");
    const preview = document.getElementById("filePreview");
    const form = document.getElementById("voucherForm");

    // ÚˆØ±Ø§Ù¾ ÚˆØ§Ø¤Ù† Ù…ÛŒÚº ØªÙ…Ø§Ù… ÙØ§Ø±Ù…ÛŒÙ¹ Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
    formatNames.forEach(name => {
      const format = formats[name];
      if (format) {
        const label = format.fileLabel || name;
        formatSelect.innerHTML += `<option value="${name}">${label} (${name})</option>`;
      }
    });

    // ÙØ§Ø±Ù…ÛŒÙ¹ Ø³Ù„ÛŒÚ©Ø´Ù† Ù¾Ø± preview Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
    formatSelect.addEventListener("change", () => {
      const selected = formatSelect.value;
      const format = formats[selected];

      if (format) {
        preview.innerHTML = `
          <b>ğŸ“ ${format.fileLabel}</b><br>
          ğŸ§¾ <i>${format.fileName}</i><br>
          <a href="${format.fileData}" target="_blank" download="${format.fileName}">â¬‡ï¸ ÙØ§Ø¦Ù„ ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</a>
        `;
        form.style.display = "block";
      } else {
        preview.innerHTML = "";
        form.style.display = "none";
      }
    });

    // ÙØ§Ø±Ù… Ø³Ø¨Ù…Ù¹
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const voucherEntry = {
        format: formatSelect.value,
        recipient: document.getElementById("recipient").value,
        date: document.getElementById("date").value,
        remarks: document.getElementById("remarks").value,
        createdBy: JSON.parse(localStorage.getItem("currentUser"))?.cnic || "unknown"
      };

      let history = JSON.parse(localStorage.getItem("voucherHistory") || "[]");
      history.push(voucherEntry);
      localStorage.setItem("voucherHistory", JSON.stringify(history));

      alert("âœ… ÙˆÙˆÚ†Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§");
      form.reset();
      preview.innerHTML = "";
      form.style.display = "none";
      formatSelect.selectedIndex = 0;
    });
  </script>
</body>
</html>
